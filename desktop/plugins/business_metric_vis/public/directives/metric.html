<form name="vudataMetricForm">
  <div class="form-group bottom-space">
    <label>
      Aggregation
    </label>
    <select
      class="form-control"
      ng-model="metric.type"
      ng-change="opts.updateMetricType()"
      name="type"
      ng-class="{error: vudataMetricForm.metric.type.$error.required}"
      required>
      <option value="count">Count</option>
      <option value="sum">Sum</option>
      <option value="avg">Average</option>
      <option value="min">Min</option>
      <option value="max">Max</option>
      <option value="cardinality">Unique Count</option>
      <option value="latest">Latest value</option>
    </select>
  </div>
  <div ng-show="opts.showFields">
    <div class="form-group bottom-space">
      <label>
        Field
      </label>
      <select
        ng-show="!opts.showStringFields"
        class="form-control"
        name="field"
        ng-options="field.name as field.name group by field.type for field in indexFields | filter:field.type='number' | orderBy:'name'"
        ng-model="metric.field"
        ng-change="opts.updateFieldName()"
        ng-required="opts.showFields"
        ng-class="{error: vudataMetricForm.metric.field.$error.required}">
      </select>
      <select
        ng-show="opts.showStringFields"
        class="form-control"
        name="field"
        ng-options="field.name as field.name group by field.type for field in indexFields | orderBy:'name'"
        ng-model="metric.field"
        ng-change="opts.updateFieldName()"
        ng-required="opts.showFields"
        ng-class="{error: vudataMetricForm.metric.field.$error.required}">
      </select>
    </div>
  </div>
  <div class="form-group bottom-space">
    <label>
      Custom Label
    </label>
    <input
      class="form-control"
      type="text"
      ng-model="metric.label"
      name="metricAlias"
      ng-maxlength="40"
      required/>
    <p
      class="error-highlight"
      ng-show="vudataMetricForm.metricAlias.$error.maxlength">
      Custom label must be less than 40 characters
    </p>
  </div>
  <div class="form-group bottom-space">
    <label>
      Description
      <kbn-tooltip
        text="Description added here will be shown as a help text when hovered over the help icon next to 'Custom Label'"
        placement="right"
        append-to-body="1">
        <span>
          <i
            class="fa fa-question-circle"
            aria-hidden="true">
          </i>
        </span>
      </kbn-tooltip>
    </label>
    <input
      class="form-control"
      type="text"
      ng-model="metric.description"
      ng-maxlength="220"
      name="metricDescription"/>
    <p
      class="error-highlight"
      ng-show="vudataMetricForm.metricDescription.$error.maxlength">
      Description must be less than 220 characters
    </p>
  </div>
  <div class="collapse-header-wrapper">
    <button
      aria-label="{{ opts.optionsEnabled ? 'Close' : 'Open' }}"
      ng-click="opts.optionsEnabled = !opts.optionsEnabled"
      type="button"
      class="kuiButton kuiButton--primary kuiButton--small vis-editor-agg-header-toggle">
        <i
          aria-hidden="true"
          ng-class="{ 'fa-caret-down': opts.optionsEnabled,
          'fa-caret-right': !opts.optionsEnabled }"
          class="fa">
        </i>
    </button>
    <!-- title -->
    <span class="collapse-header">
      Options
      <kbn-tooltip
        text="Use this to customize the visualization according to your requirements"
        placement="right"
        append-to-body="1">
        <span>
          <i
            class="fa fa-question-circle"
            aria-hidden="true">
          </i>
        </span>
      </kbn-tooltip>
    </span>
  </div>
  <div class="vudata-options"
    ng-show="opts.optionsEnabled">
    <div class="form-group bottom-space">
      <label>
        Filter
        <kbn-tooltip
        text="Use this to enter additional filters.To perform a free text based filter, simply enter a text string. To filter based on a value in a specific field, prefix the value with the name of the field. For example, enter status:200 to limit the rule to data that contain the value 200 in the status field. To specify multiple such conditions, use operators"
        placement="right"
        append-to-body="1">
          <span>
            <i
              class="fa fa-question-circle"
              aria-hidden="true">
            </i>
          </span>
        </kbn-tooltip>
      </label>
      <input
        class="form-control"
        type="text"
        ng-model="metric.filter"
        name="metricFilter"/>
    </div>
    <div class="form-group bottom-space">
      <label>
        Goal
        <kbn-tooltip
        text="Provide insights regarding the feasible range for the business metric visualization. This will be shown below the metric value"
        placement="right"
        append-to-body="1">
          <span>
            <i
              class="fa fa-question-circle"
              aria-hidden="true">
            </i>
          </span>
        </kbn-tooltip>
      </label>
      <input
        class="form-control"
        type="text"
        ng-model="metric.goalLabel"
        ng-maxlength="40"
        name="metricgoalLabel"/>
      <p
        class="error-highlight"
        ng-show="vudataMetricForm.metricgoalLabel.$error.maxlength">
        Goal label must be less than 40 characters
      </p>
    </div>

    <!-- Color schema config  starts-->
    <div class="collapse-header-wrapper">
      <button
        aria-label="{{ showColorSchemaOptions ? 'Close' : 'Open' }}"
        ng-click="showColorSchemaOptions = !showColorSchemaOptions"
        type="button"
        class="kuiButton kuiButton--primary kuiButton--small vis-editor-agg-header-toggle">
          <i
            aria-hidden="true"
            ng-class="{ 'fa-caret-down': showColorSchemaOptions,
            'fa-caret-right': !showColorSchemaOptions }"
            class="fa">
          </i>
      </button>

      <!-- title -->
      <span class="collapse-header">
        Color Schema
      </span>
    </div>

    <div
      ng-if="showColorSchemaOptions">
      <div class="form-group bottom-space">
        <label>
          Enable color schema
          <kbn-tooltip text="Configure color indicators for this metric. It allows you to specify colors to be used. If metric doesn't fall under any range, it will use the default color." placement="right" append-to-body="1">
            <span>
              <i
                class="fa fa-question-circle"
                aria-hidden="true">
              </i>
            </span>
          </kbn-tooltip>
        </label>
        <input
          type="checkbox"
          class="vudata-checkbox"
          ng-model="opts.colorSchemaEnabled"
          ng-change="opts.toggleColorSchema()"/>
      </div>
      <div
        class="form-group bottom-space"
        ng-show="opts.colorSchemaEnabled">
          <vudata-metric-color-schema
            metric-type="metric.type"
            color-schema="metric.colorSchema"
            index-fields="indexFields"
            field="opts.fieldObj">
          </vudata-metric-color-schema>
      </div>
      <div
        class="form-group bottom-space">
        <label>
          Enable background theme
          <kbn-tooltip text="Enable this to have background color as a severity indicator for the metric"
            placement="right" append-to-body="1">
            <span>
              <i
                class="fa fa-question-circle"
                aria-hidden="true">
              </i>
            </span>
          </kbn-tooltip>
        </label>
        <input
          type="checkbox"
          class="vudata-checkbox"
          ng-model="metric.bgColorEnabled"/>
      </div>
    </div>
    <!-- Color schema config ends-->
  </div>
  <div class="form-group bottom-space">
    <label>
      Indicate upward trend with
      <kbn-tooltip
        text="Select a color which should be used to indicate the metric performance"
        placement="right"
        append-to-body="1">
        <span>
          <i
            class="fa fa-question-circle"
            aria-hidden="true">
          </i>
        </span>
      </kbn-tooltip>
    </label>
    <select
      class="form-control"
      name="upTrendColor"
      ng-model="metric.upTrendColor">
      <option value="red">Red</option>
      <option value="green">Green</option>
    </select>
  </div>
  <div class="form-group bottom-space">
    <vudata-reference-link
      reference-link="metric.referenceLink">
    </vudata-reference-link>
  </div>
  <div class="form-group bottom-space">
    <div class="uvmap-vis-editor-expression">
      <div>
        <label>
          Advanced Configuration
          <kbn-tooltip
            text="Provide advanced configuration for business metric"
            placement="bottom"
            append-to-body="1">
            <span>
              <i
                class="fa fa-question-circle"
                aria-hidden="true">
              </i>
            </span>
          </kbn-tooltip>
        </label>
      </div>
      <textarea
        ng-model="metric.advancedConfig"
        class="form-control"
        rows="5">
      </textarea>
    </div>
  </div>
</form>
