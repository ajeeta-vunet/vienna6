<!DOCTYPE html>
<html>
    <head>
        <title>Horizon Chart Test</title>
        <style>
            body {
                font: 10px sans-serif;
                fill: #444;
                background: #f4f4f4;
            }

            svg {
                position: absolute;
                top: 0;
            }

            rect {
                fill: #fff;
            }
        </style>
    </head>
    <body>

        <div id="horizon-chart"></div>

        <script src="../lib/d3/d3.min.js"></script>
        <script src="../k4.d3.js"></script>

        <script>
            var data = [
                {
                    "year":[
                        2000,2000,2000,2000,2000,2000,2000,2000,2000,
                        2000,2000,2000,2001,2001,2001,2001,2001,2001,
                        2001,2001,2001,2001,2001,2001,2002,2002,2002,
                        2002,2002,2002,2002,2002,2002,2002,2002,2002,
                        2003,2003,2003,2003,2003,2003,2003,2003,2003,
                        2003,2003,2003,2004,2004,2004,2004,2004,2004,
                        2004,2004,2004,2004,2004,2004,2005,2005,2005,
                        2005,2005,2005,2005,2005,2005,2005,2005,2005,
                        2006,2006,2006,2006,2006,2006,2006,2006,2006,
                        2006,2006,2006,2007,2007,2007,2007,2007,2007,
                        2007,2007,2007,2007,2007,2007,2008,2008,2008,
                        2008,2008,2008,2008,2008,2008,2008,2008,2008,
                        2009,2009,2009,2009,2009,2009,2009,2009,2009,
                        2009,2009,2009,2010,2010
                    ],
                    "month":[
                        1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,
                        10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,
                        6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,
                        2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,
                        11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,
                        8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2
                    ],
                    "rate":[
                        4.5,4.4,4.3,3.7,3.8,4.1,4.2,4.1,3.8,3.6,3.7,3.7,
                        4.7,4.6,4.5,4.2,4.1,4.7,4.7,4.9,4.7,5,5.3,5.4,
                        6.3,6.1,6.1,5.7,5.5,6,5.9,5.7,5.4,5.3,5.6,5.7,
                        6.5,6.4,6.2,5.8,5.8,6.5,6.3,6,5.8,5.6,5.6,5.4,
                        6.3,6,6,5.4,5.3,5.8,5.7,5.4,5.1,5.1,5.2,5.1,5.7,
                        5.8,5.4,4.9,4.9,5.2,5.2,4.9,4.8,4.6,4.8,4.6,5.1,
                        5.1,4.8,4.5,4.4,4.8,5,4.6,4.4,4.1,4.3,4.3,5,4.9,
                        4.5,4.3,4.3,4.7,4.9,4.6,4.5,4.4,4.5,4.8,5.4,5.2,
                        5.2,4.8,5.2,5.7,6,6.1,6,6.1,6.5,7.1,8.5,8.9,9,
                        8.6,9.1,9.7,9.7,9.6,9.5,9.5,9.4,9.7,10.6,10.4
                    ]
                },
                {
                    "year": [
                        2000,2000,2000,2000,2000,2000,2000,2000,2000,
                        2000,2000,2000,2001,2001,2001,2001,2001,2001,
                        2001,2001,2001,2001,2001,2001,2002,2002,2002,
                        2002,2002,2002,2002,2002,2002,2002,2002,2002,
                        2003,2003,2003,2003,2003,2003,2003,2003,2003,
                        2003,2003,2003,2004,2004,2004,2004,2004,2004,
                        2004,2004,2004,2004,2004,2004,2005,2005,2005,
                        2005,2005,2005,2005,2005,2005,2005,2005,2005,
                        2006,2006,2006,2006,2006,2006,2006,2006,2006,
                        2006,2006,2006,2007,2007,2007,2007,2007,2007,
                        2007,2007,2007,2007,2007,2007,2008,2008,2008,
                        2008,2008,2008,2008,2008,2008,2008,2008,2008,
                        2009,2009,2009,2009,2009,2009,2009,2009,2009,
                        2009,2009,2009,2010,2010
                    ],
                    "month": [
                        1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,
                        10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,
                        6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,
                        2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,
                        11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,
                        8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2
                    ],
                    "rate": [
                        4.5,4.4,4.3,3.7,3.8,4.1,4.2,4.1,3.8,3.6,3.7,3.7,
                        4.7,4.6,4.5,4.2,4.1,4.7,4.7,4.9,4.7,5,5.3,5.4,
                        6.3,6.1,6.1,5.7,5.5,6,5.9,5.7,5.4,5.3,5.6,5.7,
                        6.5,6.4,6.2,5.8,5.8,6.5,6.3,6,5.8,5.6,5.6,5.4,
                        6.3,6,6,5.4,5.3,5.8,5.7,5.4,5.1,5.1,5.2,5.1,5.7,
                        5.8,5.4,4.9,4.9,5.2,5.2,4.9,4.8,4.6,4.8,4.6,5.1,
                        5.1,4.8,4.5,4.4,4.8,5,4.6,4.4,4.1,4.3,4.3,5,4.9,
                        4.5,4.3,4.3,4.7,4.9,4.6,4.5,4.4,4.5,4.8,5.4,5.2,
                        5.2,4.8,5.2,5.7,6,6.1,6,6.1,6.5,7.1,8.5,8.9,9,
                        8.6,9.1,9.7,9.7,9.6,9.5,9.5,9.4,9.7,10.6,10.4
                    ]
                },
                {
                    "year": [
                        2000,2000,2000,2000,2000,2000,2000,2000,2000,
                        2000,2000,2000,2001,2001,2001,2001,2001,2001,
                        2001,2001,2001,2001,2001,2001,2002,2002,2002,
                        2002,2002,2002,2002,2002,2002,2002,2002,2002,
                        2003,2003,2003,2003,2003,2003,2003,2003,2003,
                        2003,2003,2003,2004,2004,2004,2004,2004,2004,
                        2004,2004,2004,2004,2004,2004,2005,2005,2005,
                        2005,2005,2005,2005,2005,2005,2005,2005,2005,
                        2006,2006,2006,2006,2006,2006,2006,2006,2006,
                        2006,2006,2006,2007,2007,2007,2007,2007,2007,
                        2007,2007,2007,2007,2007,2007,2008,2008,2008,
                        2008,2008,2008,2008,2008,2008,2008,2008,2008,
                        2009,2009,2009,2009,2009,2009,2009,2009,2009,
                        2009,2009,2009,2010,2010
                    ],
                    "month": [
                        1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,
                        10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,
                        6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,
                        2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,
                        11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,
                        8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2
                    ],
                    "rate": []
                }

            ]

            console.log(data[2]);
            for (var i = 0; i < 122; i++) {
                var number = Math.random() * 11;
                data[2].rate.push(number.toFixed(1));
            }

            // Offset so that positive is above-average and negative is below-average.
            var mean = data.map(function(d) {
                return d.rate.reduce(function(p, v) { return p + v; }, 0) / d.rate.length;
            });

            // Need to add this to the horizon function
            // Transpose column values to rows.
            data = data.map(function(d) {
                return d.rate.map(function(rate, i) {
                    return [Date.UTC(data[0].year[i], data[0].month[i] - 1), rate - mean[0]];
                });
            });

            var width = 960,
                height = 330;

            var chart = k4.horizon()
                .width(width)
                .height(height)
                .bands(3)
                .mode("mirror")
                .interpolate("basis");

            // Think about changing defs to some element like svg or path where src module
            var svg = d3.select("#horizon-chart").append("svg")
                .attr("width", width)
                .attr("height", height);

            // Render the chart.
            var g = svg.selectAll("g")
                .data(data)
                .enter().append("g")
                .attr("class", "symbol")
                .attr("transform", function (d, i) {
                    var m = height/data.length;
                    return "translate(0," + i * m + ")";
                });

            //svg.data([data]).call(chart);
            g.each(function(d) {
                d3.select(this)
                    .data(data, function(d) { return [d]; })
                    .call(chart.height(height/data.length));
            });
        </script>
    </body>
</html>
