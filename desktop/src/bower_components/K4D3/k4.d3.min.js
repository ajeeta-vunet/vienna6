/*! K4D3 - v0.1.0 - 2014-03-28 */!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"object"==typeof module&&module.exports?module.exports=b():a.k4=b()}(this,function(){var a={version:"0.0.0"};return a.Chart=function(b,c){"use strict";if("function"!=typeof a[c.type])throw c.type+" is not a supported k4 function.";var d=c.type,e=a[d](b,c);return e},a.tooltip=function(){"use strict";function a(a){t=n(a),u=t.createSVGPoint(),document.body.appendChild(s)}function b(){return"n"}function c(){return[0,0]}function d(){return" "}function e(){var a=o();return{top:a.n.y-s.offsetHeight,left:a.n.x-s.offsetWidth/2}}function f(){var a=o();return{top:a.s.y,left:a.s.x-s.offsetWidth/2}}function g(){var a=o();return{top:a.e.y-s.offsetHeight/2,left:a.e.x}}function h(){var a=o();return{top:a.w.y-s.offsetHeight/2,left:a.w.x-s.offsetWidth}}function i(){var a=o();return{top:a.nw.y-s.offsetHeight,left:a.nw.x-s.offsetWidth}}function j(){var a=o();return{top:a.ne.y-s.offsetHeight,left:a.ne.x}}function k(){var a=o();return{top:a.sw.y,left:a.sw.x-s.offsetWidth}}function l(){var a=o();return{top:a.se.y,left:a.e.x}}function m(){var a=d3.select(document.createElement("div"));return a.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),a.node()}function n(a){return a=a.node(),"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function o(){var a=v||d3.event.target,b={},c=a.getScreenCTM(),d=a.getBBox(),e=d.width,f=d.height,g=d.x,h=d.y,i=document.documentElement?document.documentElement:document.body,j=i.scrollTop,k=i.scrollLeft;return u.x=g+k,u.y=h+j,b.nw=u.matrixTransform(c),u.x+=e,b.ne=u.matrixTransform(c),u.y+=f,b.se=u.matrixTransform(c),u.x-=e,b.sw=u.matrixTransform(c),u.y-=f/2,b.w=u.matrixTransform(c),u.x+=e,b.e=u.matrixTransform(c),u.x-=e/2,u.y-=f/2,b.n=u.matrixTransform(c),u.y+=f,b.s=u.matrixTransform(c),b}var p=b,q=c,r=d,s=m(),t=null,u=null,v=null;a.show=function(){var b=Array.prototype.slice.call(arguments);b[b.length-1]instanceof SVGElement&&(v=b.pop());var c,d=r.apply(this,b),e=q.apply(this,b),f=p.apply(this,b),g=d3.select(s),h=x.length;for(g.html(d).style({opacity:1,"pointer-events":"all"});h--;)g.classed(x[h],!1);return c=w.get(f).apply(this),g.classed(f,!0).style({top:c.top+e[0]+"px",left:c.left+e[1]+"px"}),a},a.hide=function(){var b=d3.select(s);return b.style({opacity:0,"pointer-events":"none"}),a},a.attr=function(b){if(arguments.length<2&&"string"==typeof b)return d3.select(s).attr(b);var c=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(d3.select(s),c),a},a.style=function(b){if(arguments.length<2&&"string"==typeof b)return d3.select(s).style(b);var c=Array.prototype.slice.call(arguments);return d3.selection.prototype.style.apply(d3.select(s),c),a},a.direction=function(b){return arguments.length?(p=null===b?b:d3.functor(b),a):p},a.offset=function(b){return arguments.length?(q=null===b?b:d3.functor(b),a):q},a.html=function(b){return arguments.length?(r=null===b?b:d3.functor(b),a):r};var w=d3.map({n:e,s:f,e:g,w:h,nw:i,ne:j,sw:k,se:l}),x=w.keys();return a},a.legend=function(a){"use strict";return a.each(function(){var a,b=d3.select(this),c={},d=d3.select(b.property("nearestViewportElement")),e=b.attr("data-style-padding")||5,f=b.selectAll(".legend-box").data([!0]),g=b.selectAll(".legend-items").data([!0]);f.enter().append("rect").classed("legend-box",!0),g.enter().append("g").classed("legend-items",!0),d.selectAll("[data-legend]").each(function(){var a=d3.select(this);c[a.attr("data-legend")]={pos:a.attr("data-legend-pos")||this.getBBox().y,color:null!==a.attr("data-legend-color")?a.attr("data-legend-color"):a.style("none"!==a.style("fill")?"fill":"stroke")}}),c=d3.entries(c).sort(function(a,b){return a.value.pos-b.value.pos}),g.selectAll("text").data(c,function(a){return a.key}).call(function(a){a.enter().append("text")}).call(function(a){a.exit().remove()}).attr("class","legend-text").attr("x","0.7em").attr("y",function(a,b){return b+"em"}).text(function(a){return a.key}),g.selectAll("circle").data(c,function(a){return a.key}).call(function(a){a.enter().append("circle")}).call(function(a){a.exit().remove()}).attr("class","legend-circle").attr("cx",0).attr("cy",function(a,b){return b-.25+"em"}).attr("r","0.4em").style("fill",function(a){return a.value.color}),a=g[0][0].getBBox(),f.attr("x",a.x-e).attr("y",a.y-e).attr("height",a.height+2*e).attr("width",a.width+2*e)}),a},a.histogram=function(b,c){"use strict";function d(a,b){var c,d,e;return c=d3.select(a).selectAll("div").data(b.rows).enter().append("div").attr("class",function(a,b){return"row r"+b}),d=c.selectAll("div").data(function(a){return a.columns}).enter().append("div").attr("class",function(a,b){return"col c"+b}),e=d.append("svg")}function e(){var a=parseInt(d3.select(b).style("width"),10),c=parseInt(d3.select(b).style("padding-bottom"),10),d=a/n,i=c/m,j=d-r.left-r.right,k=i-r.top-r.bottom;d3.select(".row r").style("width",a).style("height",i),d3.select(".col c").style("width",d).style("height",i),f.attr("width",d).attr("height",i),"group"===l?y.rangeRoundBands([0,j],.4):y.rangeRoundBands([0,j],.1),z.range([k,0]).nice(),A.ticks(Math.max(j/30,2)),B.ticks(Math.max(k/12,2)).tickSize(-j,0),300>j&&80>k?g.select(".x.axis").style("display","none"):(g.select(".x.axis").style("display","initial"),g.select(".y.axis").style("display","initial")),g.select(".x.axis").attr("transform","translate(0,"+k+")").call(A),g.select(".y.axis").call(B),"group"===l?h.selectAll("rect").attr("x",function(a,b,c){return y(a.x)+y.rangeBand()/n*c}).attr("width",y.rangeBand()/n).attr("y",function(a){return z(a.y)}).attr("height",function(a){return k-z(a.y)}):g.selectAll("rect").attr("width",y.rangeBand()).attr("x",function(a){return y(a.x)}).attr("height",function(a){return z(a.y0)-z(a.y0+a.y)}).attr("y",function(a){return z(a.y0+a.y)}),d3.select(window).on("resize",e)}var f,g,h,i={},j=parseInt(d3.select(b).style("width"),10),k=parseInt(d3.select(b).style("padding-bottom"),10),l=c.stacktype||"zero",m=data.rows.length,n=data.rows[0].columns.length,o=data.rows[0].columns[0].layers.length,p=j,q=k/m,r={top:.05*q,right:.05*p,bottom:.15*q,left:.05*p},s=p/n-r.left-r.right,t=q-r.top-r.bottom,u=data.rows[0].columns[0].layers[0].values.map(function(a){return a.x}),v=d3.layout.stack().offset(l).values(function(a){return a.values}),w=d3.max(data.rows.map(function(a){return d3.max(a.columns,function(a){return d3.max(v(a.layers),function(a){return d3.max(a.values,function(a){return a.y})})})})),x=d3.max(data.rows.map(function(a){return d3.max(a.columns,function(a){return d3.max(v(a.layers),function(a){return d3.max(a.values,function(a){return a.y0+a.y})})})})),y=d3.scale.ordinal().domain(u).rangeRoundBands([0,s],.1),z=d3.scale.linear().range([t,0]),A=d3.svg.axis().scale(y).tickSize(3,0).tickPadding(6).orient("bottom"),B=d3.svg.axis().scale(z).tickSize(-s,0).tickPadding(4).orient("left"),C=d3.scale.linear().domain([0,o-1]).range(c.color)||d3.scale.linear().domain([0,o-1]).range(["#e24700","#f9e593"]),D=a.tooltip().attr("class","k4-tip").html(function(a){return a.y<1?"<span>x: "+a.x+"</span><br><span>y: "+100*a.y.toFixed(2)+"%</span>":"<span>x: "+a.x+"</span><br><span>y: "+a.y+"</span>"}).offset([-12,0]);return i.render=function(a){return f=d(b,a),f.attr("width",p/n).attr("height",q),g=f.append("g").attr("transform","translate("+r.left+","+r.top+")").each(function(){{var b=d3.select(this);d3.max(a.rows,function(a){return d3.max(a.columns,function(a){return d3.max(a.layers,function(a){return d3.max(a.values,function(a){return a.y})})})})}"expand"===l?z.domain([0,1]):"group"===l?(z.domain([0,w]),y.rangeRoundBands([0,s],.2)):z.domain([0,x]),b.append("g").append("rect").attr("class","bkgd").style("fill","#fff").style("opacity",.35).attr("width",s).attr("height",t),b.append("g").attr("class","x axis").attr("transform","translate(0,"+t+")").style("stroke-width",.5).call(A),b.append("g").attr("class","y axis").style("stroke-width",.5).call(B),h=b.selectAll(".layer").data(function(a){return v(a.layers)}).enter().append("g").attr("class","layer").style("fill",function(a,b){return C(b)}),"group"===l&&h.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("x",function(a,b,c){return y(a.x)+y.rangeBand()/o*c}).attr("width",y.rangeBand()/o).attr("y",function(a){return z(a.y)}).attr("height",function(a){return t-z(a.y)}).on("mouseover",D.show).on("mouseout",D.hide),h.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("width",y.rangeBand()).attr("x",function(a){return y(a.x)}).attr("y",function(a){return z(a.y0+a.y)}).attr("height",function(a){return z(a.y0)-z(a.y0+a.y)}).on("mouseover",D.show).on("mouseout",D.hide),d3.select(window).on("resize",e)}),g.call(D),f},i.margin=function(){return c.margin?(r.top="undefined"!=typeof c.margin.top?c.margin.top:r.top,r.right="undefined"!=typeof c.margin.right?c.margin.right:r.right,r.bottom="undefined"!=typeof c.margin.bottom?c.margin.bottom:r.bottom,r.left="undefined"!=typeof c.margin.left?c.margin.left:r.left,r):r},i.width=function(){return c.width?s=c.width:s},i.height=function(){return c.height?t=c.height:t},i.color=function(){return c.color?C=c.color:C},i},a});