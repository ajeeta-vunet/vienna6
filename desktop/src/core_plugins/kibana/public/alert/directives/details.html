<div class="container-fluid alert-body-container" role="main">
  <form name ="alertcfgForm">
    <h4 class="step-title">
      <span class="step-indicator">1</span>
      What's the alert about ?
    </h4>

    <div class="alert-section">
      <div class="row alert-component-wrapper">
        <div class="col-md-4">
          <div class="row">
            <div class="col-md-4">
              <p class="alert-component-label">
                Summary
                <kbn-tooltip
                  text="Value filled in here will give a summary in the alert generated. Example: ex: Link Status Down, CPU Utilization High"
                  placement="right"
                  append-to-body="1">
                  <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
              </p>
            </div>
            <div class="col-md-8">
              <input
                type="text"
                class="alert-select"
                ng-model="summary"
                name="summary"
                ng-maxlength="100"
                ng-class="{error: alertcfgForm.summary.$error.required}"
                required>
              <p
                class="error-highlight"
                ng-show="alertcfgForm.summary.$error.maxlength">
                'Summary' content must be less than 100 characters
              </p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <p class="alert-component-label">
                Severity
              </p>
            </div>
            <div class="col-md-8">
              <select
                class="alert-select"
                ng-model="severity"
                name="severity"
                ng-class="{error:alertcfgForm.severity.$error.required}" required>
                <option value="information">
                  Information
                </option>
                <option value="warning">
                  Warning
                </option>
                <option value="error">
                  Error
                </option>
                <option value="critical">
                  Critical
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-2">
              <p class="alert-component-label">Description
                <kbn-tooltip
                  text="Description about the event generated by the alert rule. When an alert is generated for this rule, the contents specified here will be added to the alert. Description about the event and suggested actions can be specified in this field. Special placeholders listed below can be used to add information like monitoring parameters, thresholds and metric observed:
                          %M -> Monitoring parameters along with its values.
                                Example: 'Monitoring parameter %M' will result in a description of 'Monitoring parameter cpu_used:18.2'

                          %m -> Only monitoring parameter values.
                                Example: 'Monitoring parameter value observed=%m' will result in a description of 'Monitoring parameter value observed=18.2'

                          %G -> Add Group by parameters and their values.
                                Example: 'Alert observed for %G' will result in a description of 'Alert observed for process:apache of host:micmac'

                          %g -> Add only Group by parameter values.
                                Example: 'Alert observed for %g' will result in a description of 'Alert observed for apache of micmac'

                          %T -> Threshold value and comparison string.
                                Example: 'Observed value is %T.' will result in a description of 'Observed value is greater than the threshold of .4.'"
                  placement="bottom"
                  append-to-body="1">
                  <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
              </p>
            </div>
            <div class="col-md-10">
              <textarea
                type="text"
                rows="4"
                cols="40"
                class="alert-description"
                name="alertDescription"
                ng-model="description"
                ng-maxlength="200"
                maxlength="200"
                placeholder="Example: 'Monitoring parameter %M' will result in a description of 'Monitoring parameter cpu_used:18.2'"
                ng-class="{error: alertcfgForm.alertDescription.$error.required}"
                required></textarea>
              <p
                class="error-highlight"
                ng-show="alertcfgForm.alertDescription.$error.maxlength">
                'Description' content must be less than 200 characters
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h4 class="step-title">
      <span class="step-indicator">
        2
      </span>
      Set the alert conditions
    </h4>

    <div data-ng-repeat="rule in ruleList track by $index" ng-init="outerIndex=$index">
      <ng-form name="subRuleForm">
        <div class="alert-section">
          <div class="row bottom-space">
            <div class="rule-number-wrapper col-md-6">
              <div class="alert-condition rule-number" ng-if="(operRuleList[$index].metrics && operRuleList[$index].metrics.length===1) || !operRuleList[$index].metrics || operRuleList[$index].metrics.length === 0">
                R{{operRuleList[$index].innerRuleIndex}}
              </div>
              <div class="alert-condition rule-number" ng-if="operRuleList[$index].metrics && operRuleList[$index].metrics.length>1">
                R{{operRuleList[$index].innerRuleIndex}} - R {{operRuleList[$index].outerRuleIndex}}
              </div>
              <p class="alert-component-label alert-condition">
                Label
              </p>
              <div class="alert-condition">
                <input
                  type="text"
                  class="alert-select"
                  ng-model="rule.ruleNameAlias"
                  ng-maxlength="32"
                  name="ruleNameAlias">
                <p
                  class="error-highlight"
                  ng-show="subRuleForm.ruleNameAlias.$error.maxlength">
                  'Label' must be less than 32 characters
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <button
                ng-if="ruleList.length > 1"
                type="button"
                class="remove crud-buttons pull-right"
                ng-click="removeRule($index)">
                <i class="fa fa-trash-o" aria-hidden="true">
                </i>
              </button>
              <div
                ng-if="ruleList.length >= 2 && outerIndex !=0"
                class="alert-component-label info-collector-section alert-condition">
                <input
                  type="checkbox"
                  name="informationCollector"
                  class="alert-checkbox"
                  ng-model="rule.informationCollector">
                  Use this for information collection only
              </div>
            </div>
          </div> <!-- row botoom-space -->
          <div class="alert-component-wrapper"  ng-init="parentIndex = $index">
            <div class="row">
              <div class="col-md-2">
                <p class="alert-condition alert-component-label">
                  Based on Business Metric
                  <kbn-tooltip
                    text="Create alert condition based on Business Metric"
                    placement="right"
                    append-to-body="1">
                    <span>
                      <i
                        class="fa fa-question-circle"
                        aria-hidden="true">
                      </i>
                    </span>
                  </kbn-tooltip>
                </p>
                <input
                  type="checkbox"
                  class="vudata-checkbox"
                  ng-model="rule.vuMetricsBased"
                  ng-checked="rule.vuMetricsBased"
                  ng-change="showVUMetric($index)"/>
                </div>
            </div>
            <div class="row bottom-space" ng-if="!rule.vuMetricsBased">
              <p class="alert-component-label alert-condition">
                Check data source
              </p>
              <select
                class="alert-select alert-condition"
                name="selectedIndex"
                ng-options="option.title for option in indexPatternList"
                ng-model="rule.selectedIndex"
                ng-class="{error: alertcfgForm.rule.selectedIndex.$error.required}"
                ng-change="setIndexPattern(rule.selectedIndex.id, $index)" required>
              </select>
            </div>
            <div class="row bottom-space" ng-if="rule.vuMetricsBased">
              <p class="alert-component-label alert-condition">
                Check Business Metric
              </p>
              <select
                class="alert-select alert-condition"
                name="selectedMetric"
                ng-options="option.title for option in vuMetricList"
                ng-model="rule.selectedMetric"
                ng-class="{error: alertcfgForm.rule.selectedMetric.$error.required}"
                ng-change="setVuMetric(rule, $index)" required>
              </select>
              <a data-ng-click="previewMetric(operRuleList[$index].vis)" href="" ng-class="{'alert-disable-preview': !operRuleList[$index].vis}"><span class="fa fa-eye"></span>Preview</a>
            </div>
            <div class="row bottom-space" data-ng-repeat="metric in operRuleList[$index].metrics track by $index" ng-if="(rule.selectedMetric && rule.vuMetricsBased)">
              <div class="row">
                <div class="col-md-8">
                  <div class="row bottom-space">
                    R{{operRuleList[parentIndex].innerRuleIndex + $index}} - {{ metric.label }}
                    <kbn-tooltip
                      text=" Index name - {{ metric.index.title }} , Saved Search - {{ metric.savedSearch.title }} , Metric type - {{ metric.type }} ,Metric field - {{ metric.field }}"
                      placement="right">
                      <span>
                        <i
                          class="fa fa-question-circle"
                          aria-hidden="true">
                        </i>
                      </span>
                    </kbn-tooltip>
                  </div>
                </div>
              </div>
            </div>
            <div class="row bottom-space" ng-if="!rule.vuMetricsBased">
              <div class="alert-condition metric-content">
                <div class="alert-condition alert-component-label">
                  Metric:
                </div>
                <select
                  class="alert-select alert-condition"
                  ng-model="rule.ruleType"
                  ng-change="updateRuleType(rule, $index)"
                  name="ruleType"
                  ng-class="{error: alertcfgForm.rule.ruleType.$error.required}" required>
                  <option value="count">
                    Count
                  </option>
                  <option value="sum">
                    Sum
                  </option>
                  <option value="average">
                    Average
                  </option>
                  <option value="min">
                    Min
                  </option>
                  <option value="max">
                    Max
                  </option>
                  <option value="unique_values">
                    Unique values
                  </option>
                  <option value="state_change">
                    State Change
                  </option>
                  <option value="latest_value">
                    Latest value
                  </option>
                </select>
                <div class="alert-condition alert-component-label">
                  of
                </div>
                <div
                  ng-hide="operRuleList[$index].targetFieldInvisibility"
                  class="alert-condition">
                  <div ng-show="!operRuleList[$index].sumOrAverageIsSelected">
                    <select
                      class="alert-select"
                      name="selectedField"
                      ng-options="field.name group by field.type for field in operRuleList[$index].indexFields | orderBy:'name'"
                      ng-model="operRuleList[$index].selectedField"
                      ng-required="!operRuleList[$index].targetFieldInvisibility"
                      ng-class="{error: alertcfgForm.rule.selectedField.$error.required}">
                    </select>
                  </div>
                  <div ng-show="operRuleList[$index].sumOrAverageIsSelected">
                    <select
                      class="alert-select"
                      name="selectedField"
                      ng-options="field.name group by field.type for field in operRuleList[$index].indexFields | filter:field.type='number' | orderBy:'name'"
                      ng-model="operRuleList[$index].selectedField"
                      ng-required="!operRuleList[$index].targetFieldInvisibility"
                      ng-class="{error: alertcfgForm.rule.selectedField.$error.required}">
                    </select>
                  </div>
                </div>
                <p
                  class="alert-condition alert-component-label"
                  ng-show="operRuleList[$index].countIsSelected">
                  events
                </p>
                <div class="alert-component-label alert-condition">
                  Alias
                </div>
                <div class="alert-condition">
                  <input
                    type="text"
                    class="alert-select"
                    ng-model="rule.metricAlias"
                    name="metricAlias">
                </div>
              </div>
            </div>
            <div class="row bottom-space" ng-if="!rule.vuMetricsBased">
              <div class="row">
                <div class="col-md-2">
                  <p class="alert-condition alert-component-label">
                    Add a threshold
                    <kbn-tooltip
                      text="Enabling this checkbox will allow sub rules to add a threshold value"
                      placement="right"
                      append-to-body="1">
                      <span>
                        <i
                          class="fa fa-question-circle"
                          aria-hidden="true">
                        </i>
                      </span>
                    </kbn-tooltip>
                  </p>
                  <input
                    type="checkbox"
                    name="enableComparisionFields"
                    class="alert-checkbox"
                    ng-change="resetComparisionFields(rule)"
                    ng-model="rule.enableComparisionFields">
                </div>
              </div>
            </div>
            <div class="row bottom-space">
              <div ng-if="operRuleList[$index].metricIsSelected">
                <div ng-if="rule.enableComparisionFields && !rule.vuMetricsBased">
                  <p class="alert-condition alert-component-label">
                    Alert when metric is
                  </p>
                  <select
                    class="alert-select alert-condition"
                    ng-model="rule.compareType"
                    name="compareType"
                    ng-class="{error: alertcfgForm.rule.compareType.$error.required}"
                    ng-required="rule.enableComparisionFields">
                    <option value="">
                    </option>
                    <option value="equal">
                      equal to
                    </option>
                    <option value="notequal">
                      not equal to
                    </option>
                    <option value="lesser">
                      less than
                    </option>
                    <option value="greater">
                      greater than
                    </option>
                  </select>
                  <input
                    ng-if="!operRuleList[$index].allowStringInCompareValue"
                    type="number"
                    step="0.0001"
                    class="alert-numericals alert-condition"
                    ng-model="rule.compareValue"
                    name="compareValue"
                    ng-class="{error: alertcfgForm.rule.compareValue.$error.required}"
                    ng-required="rule.enableComparisionFields">
                  <input
                    ng-if="operRuleList[$index].allowStringInCompareValue"
                    type="text"
                    class="alert-select alert-condition"
                    ng-model="rule.compareValueStr"
                    name="compareValue"
                    ng-class="{error: alertcfgForm.rule.compareValue.$error.required}"
                    ng-required="rule.enableComparisionFields">
                </div>
                <div ng-if="!rule.enableComparisionFields || rule.vuMetricsBased">
                  <div ng-if="!operRuleList[$index].allowStringInCompareValue || rule.vuMetricsBased">
                    <div class="alert-condition alert-component-label">
                      Get metric
                    </div>
                  </div>
                </div>
                <div ng-if="!operRuleList[$index].allowStringInCompareValue || rule.vuMetricsBased">
                  <div class="alert-condition alert-component-label">
                    in last
                  </div>
                  <input
                    type="number"
                    class="alert-numericals alert-condition"
                    ng-model="rule.ruleTypeDuration"
                    min="1"
                    name="ruleTypeDuration"
                    ng-class="{error: alertcfgForm.rule.ruleTypeDuration.$error.required}"
                    ng-required="operRuleList[$index].sumOrAverageIsSelected">
                  <p class="error-highlight" ng-show="subRuleForm.ruleTypeDuration.$error.min">
                    Time values cannot be less than 1
                  </p>
                  <select
                    class="alert-select alert-condition"
                    ng-model="rule.ruleTypeDurationType"
                    name="ruleTypeDurationType"
                    ng-class="{error: alertcfgForm.rule.ruleTypeDurationType.$error.required}"
                    ng-required="operRuleList[$index].sumOrAverageIsSelected">
                    <option value="minute">
                      Minute
                    </option>
                    <option value="hour">
                      Hour
                    </option>
                    <option value="day">
                      Day
                    </option>
                    <option value="week">
                      Week
                    </option>
                    <option value="month">
                      Month
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row bottom-space" ng-if="!rule.vuMetricsBased">
              <div class="col-md-5 zero-padding">
                <p class="alert-condition alert-component-label">
                  Alert separately for each
                  <kbn-tooltip
                    text="Alert separately based on these parameters. For example in case of Bandwidth utilization, you would want to alert separately for each interface of each router. In such a case, you would select data source as 'vunet-1-1-network-health-*' and first value in this field as 'host' and the next field as 'name'"
                    placement="right"
                    append-to-body="1">
                    <i class="fa fa-question-circle">
                    </i>
                  </kbn-tooltip>
                </p>
                <div class="alert-condition">
                  <div
                    data-ng-repeat="item in operRuleList[$index].groupByField track by $index"
                    ng-init="innerIndex=$index">
                    <p>
                      <select
                        class="alert-select groupby-option"
                        name="groupByField"
                        ng-options="field.name group by field.type for field in operRuleList[outerIndex].indexFields | orderBy:'name'"
                        ng-model="item.data">
                        <option value="">
                        </option>
                      </select>
                      <button
                        ng-show="operRuleList[outerIndex].groupByField.length > 1"
                        class="crud-buttons"
                        type="button"
                        class="remove"
                        ng-click="removeGroupByField(outerIndex, innerIndex)">
                        <i class="fa fa-trash-o" aria-hidden="true">
                        </i>
                      </button>
                    </p>
                  </div>
                  <div
                    class="row bottom-space"
                    ng-show="operRuleList[$index].groupByField.length < 3">
                    <button
                      class="add-new-field"
                      type="button"
                      ng-click="addNewGroupByField($index)">
                      <span>
                        Add another field
                      </span>
                      <i class="fa fa-plus-circle" aria-hidden="true">
                      </i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-7">
                <p class="alert-condition alert-component-label">
                  Include additional fields
                  <kbn-tooltip
                    text="Additional information fields to be included in the alert generated. When an alert is triggered by the system, latest value observed for the specified fields are added to the alert generated."
                    placement="right"
                    append-to-body="1">
                    <i class="fa fa-question-circle">
                    </i>
                  </kbn-tooltip>
                </p>
                <div class="alert-condition">
                  <div
                    data-ng-repeat="item in operRuleList[$index].additionalField track by $index"
                    ng-init="innerIndex=$index">
                    <p>
                      <select
                        class="alert-select groupby-option"
                        name="additionalField"
                        ng-options="field.name group by field.type for field in operRuleList[outerIndex].indexFields | orderBy:'name'"
                        ng-model="item.data">
                        <option value="">
                        </option>
                      </select>
                      <button
                        ng-show="operRuleList[outerIndex].additionalField.length > 1"
                        class="crud-buttons"
                        type="button"
                        class="remove"
                        ng-click="removeAdditionalField(outerIndex, innerIndex)">
                        <i class="fa fa-trash-o" aria-hidden="true">
                        </i>
                      </button>
                    </p>
                  </div>
                  <div
                    class="row bottom-space"
                    ng-show="operRuleList[$index].additionalField.length < 5">
                    <button
                      class="add-new-field"
                      type="button"
                      ng-click="addNewAdditionalField($index)">
                      <span>
                        Add another field
                      </span>
                      <i class="fa fa-plus-circle" aria-hidden="true">
                      </i>
                    </button>
                  </div>
                </div>
              </div>
            </div> <!-- row bottom-space -->
            <div class="row bottom-space" ng-if="!rule.vuMetricsBased">
              <p class="alert-component-label alert-condition">
                Filter
                <kbn-tooltip
                  text="Use this to enter additional filters.To perform a free text based filter, simply enter a text string. To filter based on a value in a specific field, prefix the value with the name of the field. For example, enter status:200 to limit the rule to data that contain the value 200 in the status field. To specify multiple such conditions, use operators"
                  placement="right"
                  append-to-body="1">
                  <i class="fa fa-question-circle">
                  </i>
                </kbn-tooltip>
              </p>
              <input
                type="text"
                class="alert-filter alert-condition"
                name="filter"
                ng-model="rule.alertFilter">
            </div>
          </div>
        </div>
      </ng-form>
    </div>
    <div ng-if="ruleList.length < 4">
      <button
        type="button"
        class="add-new-rule-button"
        ng-click="addNewRule($index)">
        <span>
          Add a new condition
        </span>
        <i class="fa fa-plus-circle" aria-hidden="true">
        </i>
      </button>
    </div>

    <h4 class="step-title">
      <span class="step-indicator">
        3
      </span>
      Rule Evaluation Conditions
    </h4>

    <div class="alert-section">
      <div class="alert-component-wrapper">
        <div class="row">
          <div class="col-md-7">
            <div class="row rule-level-threshold-wrapper">
              <div class="col-md-8">
                <span class="alert-component-label rule-level-label">
                  Rule Level Threshold
                  <kbn-tooltip
                    text="When enabled, compare the results of Rule Evaluation Criteria against a threshold. Enabling this will result in alerts getting generated only when the evaluation criteria is satisfied. For example, If evaluation criteria is (R1 + R2) > 100, alert is generated when sum of alerts condition-1 and alert condition-2 is greater than 100.We can also write this as RESULT = (R1 + R2) > 100. More complex evaluation criterias can be added in python script format."
                    placement="right"
                    append-to-body="1">
                    <i class="fa fa-question-circle">
                    </i>
                  </kbn-tooltip>
                </span>
                <input
                  type="checkbox"
                  class="rule-level-checkbox"
                  ng-model="ruleLevelThreshold"
                  ng-change="resetFieldsOnRuleLevelSelection()"
                  name="ruleLevelThreshold">
              </div>
            </div>
            <div
              ng-if="ruleLevelThreshold"
              class="row bottom-space">
              <p class="alert-component-label alert-condition">
                Alert when evaluation criteria result is
              </p>
              <select
                class="alert-select alert-condition"
                ng-model="evalCriteria.compareType"
                name="evalCriteriaCompareType"
                ng-class="{error: alertcfgForm.evalCriteriaCompareType.$error.required}"
                ng-required="ruleLevelThreshold">
                <option value="">
                </option>
                <option value="equal">
                  equal to
                </option>
                <option value="notequal">
                  not equal to
                </option>
                <option value="lesser">
                  less than
                </option>
                <option value="greater">
                  greater than
                </option>
              </select>
              <input
                type="number"
                step="0.0001"
                class="alert-numericals alert-condition"
                ng-model="evalCriteria.compareValue"
                name="evalCriteriaCompareValue"
                ng-class="{error: alertcfgForm.evalCriteriaCompareValue.$error.required}"
                ng-required="ruleLevelThreshold">
            </div>
            <div class="row bottom-space">
              <div class="alert-component-label alert-condition bottom-space">
                <div class="alert-component-label alert-condition">
                  Evaluation criteria 
                  <kbn-tooltip
                    text="Formula for evaluation of the rule result from individual alert conditions. For example, if alert condition-1(R1) counts the number successful requests, and alert condition-2(R2) counts the number of failed requests, an Evaluation criteria R1 + R2 will evaluate the total number of requests. Complex scripting is supported in the Evaluation criteria. Individual alert condition results can be referred to as R1, R2 etc in the Evaluation Criteria."
                    placement="right"
                    append-to-body="1">
                    <i class="fa fa-question-circle">
                    </i>
                  </kbn-tooltip>
                </div>
              </div>
              <div class="bottom-space">
                <textarea
                  type="text"
                  rows="6"
                  cols="80"
                  class="alert-description"
                  name="evalExpression"
                  ng-model="evalCriteria.expression"
                  ng-required="ruleLevelThreshold"
                  ng-maxlength="5000"
                  maxlength="5001"
                  ng-class="{error: alertcfgForm.evalExpression.$error.required}">
                </textarea>
                <p
                  class="error-highlight"
                  ng-show="alertcfgForm.evalExpression.$error.maxlength">
                  'Evaluation criteria' content must be less than 5000 characters
                </p>
              </div>
              <div class="alert-component-label alert-condition">
                Custom Label
                <kbn-tooltip
                  text="Name for the rule level evaluation criteria. For example, a risk score calculated from results of multiple subrules can be given a name 'Risk-Score'."
                  placement="right"
                  append-to-body="1">
                  <i class="fa fa-question-circle">
                  </i>
                </kbn-tooltip>
              </div>
              <div class="alert-condition">
                <input
                  type="text"
                  class="alert-select"
                  ng-model="evalCriteriaAlias"
                  ng-maxlength="32"
                  name="evalCriteriaAlias">
                <p
                  class="error-highlight"
                  ng-show="alertcfgForm.evalCriteriaAlias.$error.maxlength">
                  'Custom Label' must be less than 32 characters
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h4 class="step-title">
      <span class="step-indicator">
        4
      </span>
      Control your alerts
    </h4>

    <div class="alert-section">
      <div class="alert-component-wrapper">
        <div class="row">
          <div class="col-md-7">
            <div class="row bottom-space">
              <p class="alert-component-label alert-condition">
                 Enable alert
                 <kbn-tooltip
                   text="Selecting this checkbox will activate this alert"
                   placement="right"
                   append-to-body="1">
                   <i class="fa fa-question-circle">
                   </i>
                 </kbn-tooltip>
                 <input
                   type="checkbox"
                   name="enableAlert"
                   class="alert-checkbox"
                   ng-model="enableAlert">
              </p>
            </div>
            <div class="row bottom-space">
              <p class="alert-component-label alert-condition">
                 Throttling
                 <kbn-tooltip
                   text="A time duration selection mechanism through which repeated alerts can be throttled."
                   placement="right"
                   append-to-body="1">
                   <i class="fa fa-question-circle">
                   </i>
                 </kbn-tooltip>
                 <input
                   type="checkbox"
                   class="alert-checkbox"
                   ng-model="enableThrottle">
              </p>
              <div
                ng-show="enableThrottle"
                class="alert-component-label alert-condition">
                After triggering the alert, Dont trigger it for
              </div>
              <div
                ng-show="enableThrottle"
                class="alert-condition">
                <input
                  type="number"
                  class="alert-numericals"
                  name="throttleDuration"
                  ng-model="throttleDuration"
                  ng-required="enableThrottle"
                  ng-class="{error: alertcfgForm.throttleDuration.$error.required}"
                  min="1">
                <p
                  class="error-highlight"
                  ng-show="alertcfgForm.throttleDuration.$error.min">
                  Time values cannot be less than 1
                </p>
                <select
                  class="alert-select"
                  name="throttleDurationType"
                  ng-model="throttleDurationType"
                  ng-required="enableThrottle"
                  ng-class="{error: alertcfgForm.throttleDurationType.$error.required}">
                  <option value="minute">
                    Minute
                  </option>
                  <option value="hour">
                    Hour
                  </option>
                  <option value="day">
                    Day
                  </option>
                  <option value="week">
                    Week
                  </option>
                  <option value="month">
                    Month
                  </option>
                </select>
              </div>
            </div>
            <p class="alert-component-label">
              Enable alerts during
              <kbn-tooltip
                text="Provide the time duration for which the alerts need to be active, You can also decide on which days alerts need to be active by selecting the specific days."
                placement="right"
                append-to-body="1">
                <i class="fa fa-question-circle">
                </i>
              </kbn-tooltip>
              <input
                type="checkbox"
                ng-model="activeAlertCheck"
                class="alert-checkbox"
                name="activeAlertCheck">
            </p>
            <div ng-show="activeAlertCheck">
              <div class="row bottom-space">
                <div class="col-md-4">
                  <div class="input-group bootstrap-timepicker timepicker alert-timepicker">
                    <input
                      id="alert-timepicker1"
                      type="text"
                      class="form-control input-small"
                      ng-model="activeStartTime">
                      <span class="input-group-addon">
                        <i class="fa fa-clock-o" aria-hidden="true">
                        </i>
                      </span>
                  </div>
                </div>
                <div class="col-md-1">
                  <span class="alert-component-label">
                    to
                  </span>
                </div>
                <div class="col-md-6">
                  <div class="input-group bootstrap-timepicker timepicker alert-timepicker">
                    <input
                      id="alert-timepicker2"
                      type="text"
                      class="form-control input-small"
                      ng-model="activeEndTime">
                      <span class="input-group-addon">
                        <i class="fa fa-clock-o" aria-hidden="true">
                        </i>
                      </span>
                  </div>
                </div>
              </div>
              <div class="row bottom-space">
                <div
                  class="alert-days alert-condition"
                  ng-repeat="day in weekdays">
                  <input
                    type="checkbox"
                    class="alert-checkbox"
                    name="selectedDays[]"
                    value="{{day.name}}"
                    ng-model="day.selected">
                  {{day.name}}
                </div>
              </div>
            </div>
            <div class="advanced-config-container">
              <p class="alert-component-label"> Enable advanced Configuration
                <kbn-tooltip
                  text="Use this to provide advanced configurations"
                  placement="right" append-to-body="1">
                  <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
                <input
                  type="checkbox"
                  ng-model="enableAdvancedConfig"
                  class="alert-checkbox"
                  ng-change="clearAdvancedConfigTextArea()"
                  name="enableAdvancedConfig">
              </p>
              <textarea
                ng-show="enableAdvancedConfig"
                type="text"
                rows="4"
                cols="40"
                class="advanced-config"
                name="advancedConfig"
                ng-model="advancedConfig"
                ng-maxlength="500"
                maxlength="501"
                ng-required="enableAdvancedConfig">
              </textarea>
              <p class="error-highlight"
                 ng-show="alertcfgForm.advancedConfig.$error.maxlength"> 'Advanced Configuration' content must be less than 500 characters
              </p>
            </div>
          </div>
          <div class="col-md-5 alert-channels-container">
            <p class="alert-component-label">
              Report alerts using
              <kbn-tooltip
                text="Use the below channels to get notified when there is an alert"
                placement="right" append-to-body="1">
                <i class="fa fa-question-circle">
                </i>
              </kbn-tooltip>
            </p>
            <div class="row no-padding channel">
              <div class="row">
                <div class="col-md-3 channel-title-wrapper">
                    <input type="checkbox" class="alert-checkbox" ng-model="alertByTicket" name="alertByTicket">
                    <span class="alert-component-label">
                      Tickets
                      <kbn-tooltip
                        text="Open/update ticket in the ITSM system for this alert"
                        placement="bottom"
                        append-to-body="1">
                        <i class="fa fa-question-circle"></i>
                      </kbn-tooltip>
                    </span>
                </div>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="col-md-3 channel-title-wrapper">
                <input
                  type="checkbox"
                  class="alert-checkbox"
                  ng-model="alertByEmail"
                  ng-change="clearEmailField()"
                  name="alertByEmail">
                <span
                  class="alert-component-label">
                  Email
                  <kbn-tooltip
                    text="Notify the recipients over email for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="col-md-3 channel-title-wrapper">
                <span
                  class="alert-component-recipients"
                  ng-show="alertByEmail">
                    Recipients List
                  <kbn-tooltip
                    text="Choose email groups for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div class="col-md-9 channel-component-wrapper">
                <span class="alert-email">
                  <input
                    type="text"
                    ng-show="alertByEmail"
                    maxlength="512"
                    multiple-emails
                    ng-model="alertEmailId"
                    ng-required="alertByEmail && selectEmailGroupList.length == 0"
                    name="alertEmailId"
                    ng-class="{error:alertcfgForm.alertEmailId.$invalid && selectEmailGroupList.length == 0}">
                </spsan>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="col-md-3 channel-title-wrapper">
                <span
                  class="alert-component-email"
                  ng-show="alertByEmail">
                    Email Group
                  <kbn-tooltip
                    text="Choose email groups for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div class="col-md-9 channel-component-wrapper">
                <span class="alert-email"
                  ng-show="alertByEmail">
                  <searchable-multiselect
                    display-attr="description"
                    recipient-index="0"
                    value-attr="name"
                    name="alertEmailGroup"
                    ng-model = "selectEmailGroupList"
                    selected-items="selectEmailGroupList"
                    all-items="allEmailGroups"
                    add-item="addEmailGroup"
                    remove-item="removeEmailGroup"
                    ng-required="alertEmailId == undefined">
                  </searchable-multiselect>
                  <p ng-if="(selectEmailGroupList.length == 0 && alertEmailId === undefined)"
                    class="error-highlight">
                    Please provide either valid email address or choose email group from the list. You can enter multiple email address separated by a comma ','
                  </p>
                  <p ng-if="(alertcfgForm.alertEmailId.$invalid && alertEmailId !== undefined)"
                    class="error-highlight">
                    Please provide valid email address with separated by a comma ','
                  </p>
                </span>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="col-md-3 channel-title-wrapper">
                <span
                  class="alert-component-email-body"
                  ng-show="alertByEmail">
                  Email Body
                  <kbn-tooltip
                    text="Use this to provide email body content which will be used in the alert email"
                    placement="right"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div class="col-md-9 channel-component-wrapper"
                ng-show="alertByEmail">
                <textarea
                  type="text"
                  rows="6"
                  cols="56"
                  class="alert-email-body"
                  name="alertEmailBody"
                  ng-model="alertEmailBody"
                  ng-maxlength="5000">
                </textarea>
                <p
                  class="error-highlight"
                  ng-show="alertcfgForm.alertEmailBody.$error.maxlength">
                  'Email body' content must be less than 5000 characters
                </p>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="row">
                <input
                  type="checkbox"
                  class="alert-checkbox"
                  ng-model="enableRunBookAutomation"
                  ng-change="clearRunBookField()"
                  name="enableRunBookAutomation">
                <span class="alert-component-label">
                  Runbook Automation
                  <kbn-tooltip
                    text="Trigger the script for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div ng-show="enableRunBookAutomation"
                    class="row channel-property-container">
                <div class="col-md-3 channel-label">
                  Script
                </div>
                <div class="col-md-9 channel-component-wrapper">
                  <span class="alert-email">
                      <input type="text"
                              maxlength="255"
                              ng-model="runBookScript"
                              ng-required="enableRunBookAutomation"
                              name="runBookScript"
                              ng-class="{error: alertcfgForm.runBookScript.$invalid}">
                      <p class="error-highlight" ng-show="alertcfgForm.runBookScript.$invalid">
                      Please provide the path of runbook automation script</p>
                  </span>
                </div>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="row">
                <input type="checkbox" class="alert-checkbox"
                        ng-model="enableAnsiblePlaybook"
                        ng-change="clearAnsiblePlaybookFields()"
                        name="enableAnsiblePlaybook">
                <span class="alert-component-label">
                  Ansible Playbook
                  <kbn-tooltip
                    text="Run the playbook for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div ng-show="enableAnsiblePlaybook">
                <div class="row channel-property-container">
                  <div class="col-md-3 channel-label">
                    Name
                  </div>
                  <div class="col-md-9 channel-component-wrapper">
                    <span class="alert-email">
                      <input type="text"
                              maxlength="255"
                              ng-model="ansiblePlaybookName"
                              ng-required="enableAnsiblePlaybook"
                              name="ansiblePlaybookName"
                              ng-class="{error: alertcfgForm.ansiblePlaybookName.$invalid}">
                      <p class="error-highlight" ng-show="alertcfgForm.ansiblePlaybookName.$invalid">
                      Please provide a playbook name</p>
                    </span>
                  </div>
                </div>
                <div class="row channel-property-container">
                  <div class="col-md-3 channel-label">
                    Options
                  </div>
                  <div class="col-md-9 channel-component-wrapper">
                    <span class="alert-email">
                      <input type="text"
                              maxlength="255"
                              ng-model="ansiblePlaybookOptions"
                              name="ansiblePlaybookOptions"
                              ng-class="{error: alertcfgForm.ansiblePlaybookOptions.$invalid}">
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="row no-padding channel">
              <div class="row">
                <input type="checkbox" class="alert-checkbox"
                  ng-model="alertByReport"
                  ng-change="clearReportField()"
                  name="alertByReport">
                <span class="alert-component-label">
                  Reports
                  <kbn-tooltip
                    text="Notify with reports for this alert"
                    placement="bottom"
                    append-to-body="1">
                    <i class="fa fa-question-circle"></i>
                  </kbn-tooltip>
                </span>
              </div>
              <div ng-show="alertByReport">
                <div class="row channel-property-container">
                  <div class="col-md-3 channel-label">
                    Name
                  </div>
                  <div class="col-md-9 channel-component-wrapper">
                    <span class="alert-email">
                      <searchable-multiselect
                        display-attr=""
                        item-index="0"
                        value-attr="name"
                        name="alertReports"
                        ng-model = "selectReportList"
                        selected-items="selectReportList"
                        all-items="allReportTitles"
                        add-item="addReport"
                        remove-item="removeReport"
                        ng-required="alertByReport">
                      </searchable-multiselect>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <h4 ng-if="opts.userRoleCanModify" class="step-title">
      <span class="step-indicator">5</span> Test your Alerts
    </h4>
    <div ng-if="opts.userRoleCanModify" class="alert-section">
      <div class="alert-component-wrapper">
        <div class="row">
          <div class="col-md-8">
            <div class="row bottom-space">
              <p class="alert-component-label alert-condition">Execute Alert Now
                <kbn-tooltip
                  text="Execute alert with default time"
                  placement="right"
                  append-to-body="1">
                  <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
                <button
                  class="test-button test-space"
                  ng-click="executeLogs()"> Execute
                </button>
              </p>
              <div
                ng-show ="successexecuteLogs"
                class="fa fa-check alert-condition status-message success-highlight">
                Successfully triggered the alert execution
              </div>
              <div
                ng-show="failureexecuteLogs"
                class="fa fa-close alert-condition status-message error-highlight"> {{errmessage}}
              </div>
            </div>
            <div class="row bottom-space">
              <p class="alert-component-label alert-condition">Execute alert with specific time
                <kbn-tooltip
                  text="Execute alert with specific time"
                  placement="right"
                  append-to-body="1">
                 <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
                <input class="test-space alert-checkbox"
                  type="checkbox"
                  ng-model="specificcheck"
                  ng-change="goShowDate()">
              </p>
            </div>
            <div
              ng-show="specificcheck"
              class="row bottom-space">
              <div class="col-md-5 zero-padding"> From:
                <input
                  ng-required="fromtime"
                  class="datepicker-time-from"
                  type="text"
                  ng-model="fromtime"
                  ng-click="showDatefrom($event)">
                <datepicker
                  ng-show="showDateValfrom"
                  ng-click="showDatefrom($event)"
                  ng-model="fromtime"
                  max-date="totime"
                  show-weeks="false">
                </datepicker>
              </div>
              <div class="col-md-4 zero-padding"> To:
                <input
                  ng-required="totime"
                  class="datepicker-time-to"
                  type="text"
                  ng-model="totime"
                  ng-click="showDateto($event)">
                <datepicker
                  ng-show="showDateValto"
                  ng-click="showDateto($event)"
                  ng-model="totime"
                  min-date="fromtime"
                  show-weeks="false">
                </datepicker>
              </div>
              <div>
                <button
                  class="test-button"
                  ng-click="executeSpecificLogs(fromtime, totime)"> GO
                </button>
              </div>
            </div>
            <div
              ng-show ="successexecuteSpecificLogs && specificcheck"
              class="fa fa-check alert-condition status-message success-highlight">
              Successfully triggered alert execution for the specified time
            </div>
            <div
              ng-show="failureexecuteSpecificLogs && specificcheck"
              class="fa fa-close alert-condition status-message error-highlight"> {{errmessagespecificlogs}}
            </div>
          </div>
        </div>
      </div>
    </div>
    <h4 ng-if="!opts.userRoleCanModify" class="step-title">
      <span class="step-indicator">5</span> Diagnose your alert
    </h4>
    <h4 ng-if="opts.userRoleCanModify" class="step-title">
      <span class="step-indicator">6</span> Diagnose your alert
    </h4>
    <div class="alert-section">
      <div class="alert-component-wrapper">
      <div class="row">
          <div class="col-md-8">
            <div class="row bottom-space">
              <p class="alert-component-label alert-condition">
                Set Debug Level
                <kbn-tooltip
                  text="Set the debug level to <Error, Warning, Information or Debug>"
                  placement="right"
                  append-to-body="1">
                  <i class="fa fa-question-circle"></i>
                </kbn-tooltip>
              </p>
              <div class="alert-condition">
                <select
                  class="alert-select alert-condition"
                  ng-model="setDebug"
                  name="setDebugLevel"
                  ng-class="{error: alertcfgForm.setDebugLevel.$error.required}"
                  ng-required="setDebug"
                  ng-change="setDebugLevel()">
                  <option value="0">Error</option>
                  <option value="1">Warning</option>
                  <option value="2">Information</option>
                  <option value="3">Debug</option>
                  <option value="-1">Disable</option>
                </select>
              </div>
              <div
                class="fa fa-check alert-condition alert-component-label status-message success-highlight"
                ng-if="successfullyset && debugVal != 'Disable'">
                Diagnostics level set to {{debugVal}}. This will be active for next few executions.
              </div>
              <div
                class="fa fa-check alert-condition alert-component-label status-message success-highlight"
                ng-if="successfullyset && debugVal == 'Disable'">
                Debugs are disabled
              </div>
              <div
                class="fa fa-close alert-condition alert-component-label status-message error-highlight"
                ng-if="failedtoset">
                {{failedmsg}}
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <input
              class="btn btn-ui.primary bottom-space test-button"
              type="button"
              id="showhide"
              ng-click="showDebugLogs()"
              value="Show Debugs">
            <div ng-show="showDebug">
              <textarea
                readonly
                type="text"
                rows="10"
                cols="100"
                ng-model="displayDebug">
              </textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
