// This file is automatically generated using pluto meta-file framework
// Please do not make any change in this file directly.

import _ from 'lodash';

import { uiModules } from 'ui/modules';
const module = uiModules.get('kibana', ['kibana']);

import cliDataSourceTemplate from './cliDataSource.html';
import cliAddDataSourceTemplate from './cliAddDataSource.html';

module.directive('cliDataSource', function (StateService, $uibModal) {
  const cliDataSource = {
    restrict: 'E',
    requrie: '^ngModel',
    scope: {
    },
    replace: true,
    template: cliDataSourceTemplate,
    link: (scope) => {
      // Fetch the configuration from backend
      scope.$parent.current_data_source_scope = scope;

      scope.showCliModal = false;

      scope.cliModalData = {
        title: 'Confirm Delete',
        message: 'Do you want to delete this entry?',
        isForm: false
      };

      StateService.getDataSources('cli').then(function (data) {
        scope.data = data.data_source_type_list;
        scope.data_receive_list = data.data_receive_list;
        scope.index = data.data_index;
      });

      // Function to add/edit a row in DataEnrichment group
      scope.editConfig = (row, dataReceived, dataReceivedStep, configurationStep) => {

        const modalInstance = $uibModal.open({
          animation: true,
          template: cliAddDataSourceTemplate,
          controller: 'cliAddDataSourceCtrl',
          windowClass: 'data-source-configuration'
        });

        // Send the value of the edited row to modal so that the modal gets
        // populated with these values.
        if (row) {
          modalInstance.row = row;
          modalInstance.dataReceived = dataReceived;
        }

        modalInstance.data = scope.data;
        modalInstance.data_receive_list = scope.data_receive_list;
        modalInstance.index = scope.index;
        modalInstance.first_step = true;
        modalInstance.third_step = false;
        modalInstance.second_step = false;


        if (dataReceivedStep) {
          modalInstance.first_step = false;

          modalInstance.third_step = true;

        }

        if (configurationStep) {
          modalInstance.first_step = false;

          modalInstance.second_step = true;

        }

        modalInstance.result.then(() => {
          // Nothing much needs to be done here..
        });
      };

      scope.deleteDataSourceConfig = (row, index) => {
        scope.rowToDelete = row;
        scope.indexToDelete = index;
        scope.showCliModal = true;
      };

      scope.onCliModalSubmit = function () {
        StateService.deleteDataSources('cli', scope.rowToDelete.name).then(function () {
          scope.data = _.without(scope.data, scope.rowToDelete);
          scope.data_receive_list.splice(scope.indexToDelete, 1);
        });
        scope.showCliModal = false;
      };

      scope.onCliModalClose = () => {
        scope.showCliModal = false;
      };
    }
  };

  return cliDataSource;
});