// This file is automatically generated using pluto meta-file framework
// Please do not make any change in this file directly.
'use strict';

import _ from 'lodash';

import { uiModules } from 'ui/modules';
const module = uiModules.get('kibana', ['kibana']);

import jdbcDataSourceTemplate from './jdbcDataSource.html';
import jdbcAddDataSourceTemplate from './jdbcAddDataSource.html';

module.directive('jdbcDataSource', function (StateService, $uibModal) {
  const jdbcDataSource = {
    restrict: 'E',
    requrie: '^ngModel',
    scope: {
    },
    replace: true,
    template: jdbcDataSourceTemplate,
    link: (scope) => {
      // Fetch the configuration from backend
      scope.$parent.current_data_source_scope = scope;

      scope.showjdbcModal = false;

      scope.jdbcModalData = {
        title: 'Confirm Delete',
        message: 'Do you want to delete this entry?',
        isForm: false
      };

      StateService.getDataSources('jdbc').then(function(data) {
        scope.data = data.data_source_type_list;
        scope.data_receive_list = data.data_receive_list;
        scope.index = data.data_index;
      });

      StateService.getStandaloneShipperList().then(function (standalone_shipper_list) {
        scope.standalone_shipper_list = standalone_shipper_list;
      });

      // Function to add/edit a row in DataEnrichment group
      scope.editConfig = (row, data_received, data_received_step, configuration_step) => {

        const controller = 'jdbcAddDataSourceCtrl';

        const modalInstance = $uibModal.open({
          animation: true,
          template: jdbcAddDataSourceTemplate,
          controller: controller,
          windowClass: 'data-source-configuration'
        });

        // Send the value of the edited row to modal so that the modal gets
        // populated with these values.
        if (row) {
          modalInstance.row = row;
          modalInstance.data_received = data_received;
        }

        modalInstance.data = scope.data;
        modalInstance.data_receive_list = scope.data_receive_list;
        modalInstance.index = scope.index;
        modalInstance.first_step = true;
        modalInstance.third_step = false;
        modalInstance.second_step = false;
        

        if (data_received_step) {
          modalInstance.first_step = false;
          
          modalInstance.third_step = true;
          
        }

        if (configuration_step) {
          modalInstance.first_step = false;
          
          modalInstance.second_step = true;
          
        }

        modalInstance.result.then( () => {
          // Nothing much needs to be done here..
        });
      };

      scope.deleteDataSourceConfig = (row, index) => {
        scope.rowToDelete = row;
        scope.indexToDelete = index;
        scope.showjdbcModal = true;
      };

      scope.onjdbcModalSubmit = function () {
        StateService.deleteDataSources('jdbc', scope.rowToDelete.name).then(function () {
          scope.data = _.without(scope.data, scope.rowToDelete);
          scope.data_receive_list.splice(scope.indexToDelete, 1);
        });
        scope.showjdbcModal = false;
      };

      scope.onjdbcModalClose = () => {
        scope.showjdbcModal = false;
      };
    }
  };

  return jdbcDataSource;
});